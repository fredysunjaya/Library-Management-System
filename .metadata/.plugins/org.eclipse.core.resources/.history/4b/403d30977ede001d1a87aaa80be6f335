package librarymanagementsystem;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.Insets;
import java.awt.Point;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.time.LocalDate;
import java.time.ZoneId;
import java.util.ArrayList;
import java.util.Date;

import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTable;
import javax.swing.JTextField;
import javax.swing.SwingConstants;
import javax.swing.table.DefaultTableModel;

import com.toedter.calendar.JDateChooser;

public class AdminIssuedFrame extends JFrame implements ActionListener{
private Library library;
	
	// North
	private JPanel menubar = new JPanel();
	private JButton bookBtn = new JButton("Books", new ImageIcon("resources/bookIcon.png"));
	private JButton memberBtn = new JButton("Members", new ImageIcon("resources/membersIcon.png"));
	private JButton issuedBtn = new JButton("Issued Books", new ImageIcon("resources/issuedIcon.png"));
	private JButton recordBtn = new JButton("Records", new ImageIcon("resources/recordIcon.png"));
	private JButton logoutBtn = new JButton("Log Out", new ImageIcon("resources/logoutIcon.png"));
	
	// Center
	private JTable issuedTable = new JTable();
	private Object[] issuedColumn = {"ID", "Name", "ISBN", "Title", "Issue Date", "Return Date", "Status", "Fine"};
	private JScrollPane issueScrollPane = new JScrollPane(issuedTable);
	private DefaultTableModel dtmIssued;
	
	// South
	private JPanel formPanel = new JPanel();
	private JPanel emptyPanel = new JPanel();
	private JLabel fromLbl = new JLabel("From");
	private JDateChooser fromChooser = new JDateChooser();
	private JLabel toLbl = new JLabel("To");
	private JDateChooser toChooser = new JDateChooser();
	private JTextField searchTxt = new JTextField();
	private JButton searchBtn = new JButton("Search");
	private JButton viewBtn = new JButton("View Details");
	private JButton returnBtn = new JButton("Returned");
	private JButton resetBtn = new JButton("Reset Filter");
	
	public void loadTable(ArrayList<Member> members, ArrayList<Book> books) {
		issuedTable.getTableHeader().setReorderingAllowed(false);
		
		dtmIssued = new DefaultTableModel(issuedColumn, 0) {
			@Override
			public boolean isCellEditable(int row, int column) {
				// TODO Auto-generated method stub
				return false;
			}
		};
		
		for(Member member : members) {
			Object[] memberFile = {member.getId(), member.getName(), member.getBirthDate(), member.getEmail(), member.getPhoneNum()};
			
			dtmIssued.addRow(memberFile);
		}
		issuedTable.setModel(dtmIssued);
	} 
	
	public void init_component(ArrayList<Member> members, ArrayList<Book> books) {
		setLayout(new BorderLayout());
		
		GridBagLayout menubarLayout = new GridBagLayout();
		GridBagConstraints menubarConst = new GridBagConstraints();
		menubar.setLayout(menubarLayout);
		
		// Books button
		menubarConst.gridx = 0;
		menubarConst.weightx = 0.25;
		menubarConst.insets = new Insets(10, 0, 10, 0);
		bookBtn.addActionListener(this);
		bookBtn.setVerticalTextPosition(SwingConstants.BOTTOM);
	    bookBtn.setHorizontalTextPosition(SwingConstants.CENTER);
		menubar.add(bookBtn, menubarConst);
		
		// Members Button
		menubarConst.gridx++;
		memberBtn.addActionListener(this);
		memberBtn.setVerticalTextPosition(SwingConstants.BOTTOM);
	    memberBtn.setHorizontalTextPosition(SwingConstants.CENTER);
		menubar.add(memberBtn, menubarConst);
		
		// Issued Book Button
		menubarConst.gridx++;
		issuedBtn.addActionListener(this);
		issuedBtn.setVerticalTextPosition(SwingConstants.BOTTOM);
	    issuedBtn.setHorizontalTextPosition(SwingConstants.CENTER);
		menubar.add(issuedBtn, menubarConst);
		
		// Records of Issued Book Button
		menubarConst.gridx++;
		recordBtn.addActionListener(this);
		recordBtn.setVerticalTextPosition(SwingConstants.BOTTOM);
	    recordBtn.setHorizontalTextPosition(SwingConstants.CENTER);
		menubar.add(recordBtn, menubarConst);
		
		// Logout Button
		menubarConst.gridx++;
		logoutBtn.addActionListener(this);
		logoutBtn.setVerticalTextPosition(SwingConstants.BOTTOM);
	    logoutBtn.setHorizontalTextPosition(SwingConstants.CENTER);
		menubar.add(logoutBtn, menubarConst);
		
		// Table of Members
		loadTable(members, books);
		
		// Issued Form
		GridBagLayout formLayout = new GridBagLayout();
		GridBagConstraints formConst = new GridBagConstraints();
		formConst.fill = GridBagConstraints.HORIZONTAL;
		formPanel.setLayout(formLayout);
		
		// Left Form
		GridBagLayout leftFormLayout = new GridBagLayout();
		GridBagConstraints leftFormConst = new GridBagConstraints();
		leftFormPanel.setLayout(leftFormLayout);
		leftFormPanel.setBackground(Color.GRAY);
		
		// ID Label
		leftFormConst.gridx = 0;
		leftFormConst.gridy = 0;
		leftFormConst.weightx = 0.25;
		leftFormConst.ipady = 10;
		leftFormConst.insets = new Insets(15, 40, 5, 40);
		leftFormPanel.add(idLbl, leftFormConst);
		
		// ID text field
		leftFormConst.gridx++;
		leftFormConst.weightx = 0.75;
		leftFormConst.fill = GridBagConstraints.HORIZONTAL;
		leftFormPanel.add(idTxt, leftFormConst);
		
		// Name Label
		leftFormConst.gridx = 0;
		leftFormConst.gridy++;
		leftFormConst.weightx = 0.25;
		leftFormConst.insets = new Insets(5, 40, 5, 40);
		leftFormConst.fill = GridBagConstraints.NONE;
		leftFormPanel.add(nameLbl, leftFormConst);
		
		// Name text field
		leftFormConst.gridx++;
		leftFormConst.weightx = 0.75;
		leftFormConst.fill = GridBagConstraints.HORIZONTAL;
		leftFormPanel.add(nameTxt, leftFormConst);	
		
		// BirthDate Label
		leftFormConst.gridx = 0;
		leftFormConst.gridy++;
		leftFormConst.weightx = 0.25;
		leftFormConst.fill = GridBagConstraints.NONE;
		leftFormPanel.add(birthDateLbl, leftFormConst);
		
		// BirthDate Chooser
		leftFormConst.gridx++;
		leftFormConst.weightx = 0.75;
		leftFormConst.fill = GridBagConstraints.HORIZONTAL;
		leftFormPanel.add(birthDateChooser, leftFormConst);
	
		// Email Label
		leftFormConst.gridx = 0;
		leftFormConst.gridy++;
		leftFormConst.weightx = 0.25;
		leftFormConst.fill = GridBagConstraints.NONE;
		leftFormPanel.add(emailLbl, leftFormConst);
		
		// Email Text field
		leftFormConst.gridx++;
		leftFormConst.weightx = 0.75;
		leftFormConst.fill = GridBagConstraints.HORIZONTAL;
		leftFormPanel.add(emailTxt, leftFormConst);

		// Phone Number Label
		leftFormConst.gridx = 0;
		leftFormConst.gridy++;
		leftFormConst.weightx = 0.25;
		leftFormConst.fill = GridBagConstraints.NONE;
		leftFormPanel.add(phoneLbl, leftFormConst);
		
		// Phone Number Text field
		leftFormConst.gridx++;
		leftFormConst.weightx = 0.75;
		leftFormConst.fill = GridBagConstraints.HORIZONTAL;
		leftFormPanel.add(phoneTxt, leftFormConst);
		
		// Password Label
		leftFormConst.gridx = 0;
		leftFormConst.gridy++;
		leftFormConst.weightx = 0.25;
		leftFormConst.fill = GridBagConstraints.NONE;
		leftFormPanel.add(passwordLbl, leftFormConst);
		
		// Password Text field
		leftFormConst.gridx++;
		leftFormConst.weightx = 0.75;
		leftFormConst.insets = new Insets(5, 40, 15, 40);
		leftFormConst.fill = GridBagConstraints.HORIZONTAL;
		leftFormPanel.add(passwordTxt, leftFormConst);
	
		// Right Form
		GridBagLayout rightFormLayout = new GridBagLayout();
		GridBagConstraints rightFormConst = new GridBagConstraints();
		rightFormPanel.setLayout(rightFormLayout);
		rightFormPanel.setBackground(Color.GREEN);
		
		// Search Text Field
		rightFormConst.gridx = 0;
		rightFormConst.gridy = 0;
		rightFormConst.gridwidth = 2;
		rightFormConst.insets = new Insets(10, 20, 10, 20);
		rightFormConst.fill = GridBagConstraints.HORIZONTAL;
		rightFormPanel.add(searchTxt, rightFormConst);
		
		// Search Button
		rightFormConst.gridwidth = 1;
		rightFormConst.gridx = GridBagConstraints.RELATIVE;
//		rightFormConst.fill = GridBagConstraints.NONE;
		rightFormPanel.add(searchBtn, rightFormConst);
		
		// Add Button
		rightFormConst.gridx = 0;
		rightFormConst.gridy++;
		rightFormConst.weightx = 1;
		rightFormConst.fill = GridBagConstraints.HORIZONTAL;
		addBtn.addActionListener(this);
		rightFormPanel.add(addBtn, rightFormConst);
		
		// Delete Button
		rightFormConst.gridx++;
		deleteBtn.addActionListener(this);
		rightFormPanel.add(deleteBtn, rightFormConst);
		
		// Update Button
		rightFormConst.gridx++;
		viewBtn.addActionListener(this);
		rightFormPanel.add(viewBtn, rightFormConst);

//		memberTable.getSelectionModel().addListSelectionListener(new ListSelectionListener() {		
//			@Override
//			public void valueChanged(ListSelectionEvent e) {
//				// TODO Auto-generated method stub
//				int row = memberTable.getSelectedRow();
//				
//				if(row != -1) {
//					idTxt.setText(memberTable.getValueAt(row, 0).toString());
//					nameTxt.setText(memberTable.getValueAt(row, 1).toString());
//					LocalDate tmp = (LocalDate) memberTable.getValueAt(row, 2);
//					Date date = Date.from(tmp.atStartOfDay(ZoneId.systemDefault()).toInstant());
//					birthDateChooser.setDate(date);
//					emailTxt.setText(memberTable.getValueAt(row, 3).toString());
//					phoneTxt.setText(memberTable.getValueAt(row, 4).toString());	
//					passwordTxt.setText("");
//				}
//			}
//		});
		
		formConst.weightx = 0.65;
		formPanel.add(leftFormPanel, formConst);
		formConst.weightx = 0.35;
		formPanel.add(rightFormPanel, formConst);
		
		add(menubar, "North");
		add(memberScrollPane, "Center");
		add(formPanel, "South");
	}
	
	public AdminMemberFrame(Library library, int width, int height, Point point) {
		this.library = library;
		
		init_component(library.getMembers());
		setSize(width, height);
		setTitle("Library Management System");
		setDefaultCloseOperation(EXIT_ON_CLOSE);
		setLocation(point);
//		setVisible(true);
	}

	public AdminMemberFrame() {
		// TODO Auto-generated constructor stub
	}

	public void resetForm() {
		idTxt.setText("");
		nameTxt.setText("");
		birthDateChooser.setDate(null);
		emailTxt.setText("");
		phoneTxt.setText("");
		passwordTxt.setText("");
	}
	
	@Override
	public void actionPerformed(ActionEvent e) {
		// TODO Auto-generated method stub
		if(e.getSource().equals(bookBtn)) {
			Point point = getLocationOnScreen();
			this.setVisible(false);
			new AdminBookFrame(library, getWidth(), getHeight(), point).setVisible(true);
		} else if(e.getSource().equals(memberBtn)) {
			
		} else if(e.getSource().equals(issuedBtn)) {
			
		} else if(e.getSource().equals(recordBtn)) {
			
		} else if(e.getSource().equals(logoutBtn)) {
			library.logout(this, getWidth(), getHeight());
		} else if(e.getSource().equals(addBtn)) {
			String id = idTxt.getText();
			String name = nameTxt.getText();
			
			Date date = birthDateChooser.getDate();
			LocalDate birthDate = date.toInstant().atZone(ZoneId.systemDefault()).toLocalDate();
			
			String email = emailTxt.getText();
			String phoneNum = phoneTxt.getText();
			String password = passwordTxt.getText();
			Object[] row = {id, name, birthDate, email, phoneNum, password};
			
			library.addMember(id, name, birthDate, email, phoneNum, password);
			dtmMember.addRow(row);
			memberTable.invalidate();
			resetForm();
		} else if(e.getSource().equals(deleteBtn)) {
			int selectedRow = memberTable.getSelectedRow();
			
			if(selectedRow != -1) {
				resetForm();
				dtmMember.removeRow(selectedRow);
				library.removeMember(selectedRow);
				memberTable.invalidate();
			}
		} else if(e.getSource().equals(viewBtn)) {
			
		}
	}
}
